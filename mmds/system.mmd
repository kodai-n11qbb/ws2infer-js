flowchart TD
  subgraph "Sender (最小HTML)"
    S[getUserMedia<br/>カメラ/マイク取得]
    PC[RTCPeerConnection<br/>モード選択:1on1 or 1onN]
    MODE1[1on1モード<br/>Offer生成]
    MODEN[1onNモード<br/>複数Offer管理]
  end
  
  subgraph "Rust Signaling Server (オフライン運用)"
    WS[WebSocket Server<br/>Warp/Tokio-tungstenite]
    ROOM[Room管理<br/>1on1用/1onN用]
    STUN[内蔵STUN<br/>ローカルIP発見]
    TURN[内蔵TURN<br/>同一LAN中継]
  end
  
  subgraph "Viewer (自動接続HTML)"
    V1[getUserMedia<br/>自動開始]
    V1PC[RTCPeerConnection<br/>自動Offer監視]
    V2[getUserMedia<br/>自動開始] 
    V2PC[RTCPeerConnection<br/>自動Offer監視]
  end

  S --> PC
  PC --> MODE1
  PC --> MODEN
  MODE1 --> WS
  MODEN --> WS
  WS --> ROOM
  
  V1PC -.->|自動Room監視| WS
  V2PC -.->|自動Room監視| WS
  WS --> V1PC
  WS --> V2PC
  
  WS <--> STUN
  WS <--> TURN
  
  PC <-->|P2P映像/音声| V1PC
  PC <-->|P2P映像/音声| V2PC
